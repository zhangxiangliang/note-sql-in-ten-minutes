# 高级SQL特性

## 约束
* 最好不要 插入新行 时进行检查：
    * 执行 `UPDATE` 和 `DELETE` 操作时，也需要实施这些检查。
    * 执行客户端查询消耗非常高，而DBMS执行检查的效率相对较高。
    * 在客户端层面上实施数据库完整性规则，有可能不支持。

* 约束大部分是在 `CREATE TABLE` 或 `ALTER TABLE` 中定义的。

### 主键
* 满足下面条件都可以使用主键：
    * 任意两行的主键值都不相同。
    * 每行都具有一个主键值（即列中不允许NULL值）。
    * 包含主键值的列从不修改或更新。
    * 主键值不能重用。如果从表中删除某一行，其主键值不分配给新行。

* 两种定义方法：
    * `CREATE TABLE table (xxx type NOT NULL PRIMARY KEY)`。
    * `ALTER TABLE table ADD CONSTRAINT PRIMARY KEY (vend_id)`。
    * `CONSTRAINT` 在两种方法中都能使用。

* DBMS 区别：
    * SQLite不允许使用ALTER TABLE定义键，要求在初始的 `CREATE TABLE`语句中定义它们。

### 外键
* 外键是表中的一列，其值必须列在另一表的主键中。
* 外键有助防止意外删除。
* 有些 DBMS 有级联删除功能，要小心。

* 两种定义方法
    * `CREATE TABLE table (xxx type NOT NULL REFERENCES otable(id))`。
    * `ALTERR TABLE table ADD CONSTRANIT FOREIGE KEY (id) REFERENCES otable(id)`。
    * `CONSTRAINT` 在两种方法中都能使用。

### 唯一约束
* 与主键的重要区别：
    * 表可包含多个唯一约束，但每个表只允许一个主键。
    * 唯一约束列可包含NULL值。
    * 唯一约束列可修改或更新。
    * 唯一约束列的值可重复使用。
    * 与主键不一样，唯一约束不能用来定义外键。

* 唯一约束用来保证一列（或一组列）中的数据是唯一的。
* 唯一约束既可以用 `UNIQUE` 关键字在表定义中定义，也可以用单独的 `CONSTRAINT` 定义。

### 检查约束
* 检查约束用来保证一列（或一组列）中的数据满足一组指定的条件。
* 使用 `CHECK` 来定义，更多查阅 DBMS 文档。
* 常见用途：
    * 检查最小或最大值（例如不能为0）。
    * 指定范围（例如时间区间）。
    * 只允许特定的值（例如性别选择）。


## 索引
* 索引需要注意的内容：
    * 索引改善检索操作的性能，但降低了数据插入、修改和删除的性能（因为要更新）。
    * 索引数据可能要占用大量的存储空间。
    * 并非所有数据都适合做索引（取值多的比较合适）。
    * 索引用于数据过滤和数据排序（某种特定的顺序排序数据，适合索引）。
    * 可以在索引中定义多个列。

* 不同的 DBMS 创建索引方式大有不同。
* MySQL索引：
    * 普通索引 `ALTER TABLE table ADD INDEX index (column)`（值可不唯一）。
    * UNIQUE 索引 `ALTER TABLE table ADD UNIQUE (column)`。
    * 主键索引 `ALTER TABLE table ADD PRIMARY KEY (column)`。

## 触发器
* 不同 DBMS 的触发器写法不同。
* 当数据库完成某一操作的时候，自动除非设置好的SQL语句。
* 约束比触发器更快，如果可能尽量使用约束。

## 数据库安全
* 安全性使用 SQL 的`GRANT` 和 `REVOKE` 语句来管理。
* 需要保护的操作：
    * 对数据库管理功能（创建表、更改或删除已存在的表等）的访问。
    * 对特定数据库或表的访问。
    * 访问的类型（只读、对特定列的访问等）。
    * 仅通过视图或存储过程对表进行访问。
    * 创建多层次的安全措施，从而允许多种基于登录的访问和控制。
    * 限制管理用户账号的能力。

